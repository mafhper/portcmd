<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quality Gate Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
          colors: {
            background: '#0a0a0f',
            surface: '#12121a',
            surfaceHighlight: '#1a1a25',
            primary: '#22d3ee',
            primaryGlow: 'rgba(34, 211, 238, 0.15)',
            success: '#10b981',
            warning: '#f59e0b',
            error: '#ef4444',
            text: '#fafafa',
            muted: '#71717a'
          }
        }
      }
    }
  </script>
  <style>
    body { background-color: #0a0a0f; color: #fafafa; }
    .glass-card {
      background: rgba(18, 18, 26, 0.7);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.08);
    }
    .glass-card:hover { border-color: rgba(34, 211, 238, 0.2); }
    .sidebar-link { transition: all 0.2s; border-left: 2px solid transparent; }
    .sidebar-link:hover, .sidebar-link.active { background: rgba(34, 211, 238, 0.05); color: #22d3ee; border-left-color: #22d3ee; }
    .score-ring { transform: rotate(-90deg); transform-origin: 50% 50%; }
    .animate-spin-slow { animation: spin 3s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  </style>
</head>
<body class="h-screen flex overflow-hidden selection:bg-primary selection:text-black">
  
  <!-- Sidebar -->
  <aside class="w-64 bg-surface border-r border-white/5 flex flex-col z-20">
    <div class="p-6">
      <div class="flex items-center gap-3 text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-purple-500">
        <span class="text-3xl">‚ö°</span>
        Quality Gate
      </div>
      <p class="text-xs text-muted mt-2 uppercase tracking-wider">Project Audit</p>
    </div>

    <nav class="flex-1 px-4 space-y-2 mt-4">
      <a href="/" class="sidebar-link active flex items-center gap-3 px-4 py-3 text-sm font-medium text-muted rounded-r-lg">
        <span>üìä</span> Dashboard
      </a>
      <a href="/reports" class="sidebar-link flex items-center gap-3 px-4 py-3 text-sm font-medium text-muted rounded-r-lg">
        <span>üî¶</span> Lighthouse Reports
      </a>
      <a href="/analysis" class="sidebar-link flex items-center gap-3 px-4 py-3 text-sm font-medium text-muted rounded-r-lg">
        <span>üìà</span> Analytics
      </a>
      <a href="/logs" class="sidebar-link flex items-center gap-3 px-4 py-3 text-sm font-medium text-muted rounded-r-lg">
        <span>üìù</span> System Logs
      </a>
    </nav>

    <div class="p-4 border-t border-white/5">
      <div class="glass-card p-4 rounded-xl">
        <h4 class="text-xs font-bold text-muted uppercase mb-3">Quick Actions</h4>
        <div class="space-y-2">
          <button onclick="runAction('quality')" class="w-full text-left px-3 py-2 text-xs font-medium bg-primary/10 text-primary rounded hover:bg-primary/20 transition">üöÄ Run Quality Gate</button>
          <button onclick="runAction('perf')" class="w-full text-left px-3 py-2 text-xs font-medium bg-surfaceHighlight text-muted rounded hover:bg-white/5 transition">üî¶ Run Performance</button>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 overflow-auto relative">
    <!-- Noise Overlay -->
    <div class="fixed inset-0 pointer-events-none opacity-[0.03] z-0" style="background-image: url('data:image/svg+xml,%3Csvg viewBox=\'0 0 200 200\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cfilter id=\'n\'%3E%3CfeTurbulence type=\'fractalNoise\' baseFrequency=\'0.7\' numOctaves=\'3\'/%3E%3C/filter%3E%3Crect width=\'100%25\' height=\'100%25\' filter=\'url(%23n)\'/%3E%3C/svg%3E')"></div>

    <div class="max-w-7xl mx-auto p-8 relative z-10">
      
      <!-- Header -->
      <header class="flex justify-between items-end mb-8">
        <div>
          <h1 class="text-3xl font-bold text-white mb-2">Overview</h1>
          <p class="text-muted text-sm">Real-time performance and quality metrics.</p>
        </div>
        <div class="flex items-center gap-4">
            <span class="px-3 py-1 rounded-full text-xs font-medium bg-white/5 border border-white/10 text-muted">
                {{LAST_UPDATE}}
            </span>
            <button onclick="window.location.reload()" class="p-2 bg-surface hover:bg-surfaceHighlight rounded-lg text-muted transition">‚Üª</button>
        </div>
      </header>
      
      <!-- Key Metrics (Bento Grid) -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Performance -->
        <div class="glass-card rounded-2xl p-6 relative group overflow-hidden">
          <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition text-6xl">‚ö°</div>
          <div class="flex justify-between items-start mb-4">
            <h3 class="text-sm font-medium text-muted uppercase tracking-wider">Performance</h3>
            <span class="{{SCORES.perf_color}} px-2 py-0.5 rounded text-xs font-bold">{{SCORES.perf}}%</span>
          </div>
          <div class="text-4xl font-bold font-mono text-white mb-2">{{SCORES.perf}}</div>
          <p class="text-xs text-muted">Lighthouse Core Web Vitals</p>
          <div class="w-full bg-white/5 h-1.5 mt-4 rounded-full overflow-hidden">
            <div class="h-full {{SCORES.perf_bg}} transition-all duration-1000" style="width: {{SCORES.perf}}%"></div>
          </div>
        </div>

        <!-- Accessibility -->
        <div class="glass-card rounded-2xl p-6 relative group overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition text-6xl">‚ôø</div>
            <div class="flex justify-between items-start mb-4">
              <h3 class="text-sm font-medium text-muted uppercase tracking-wider">Accessibility</h3>
              <span class="{{SCORES.a11y_color}} px-2 py-0.5 rounded text-xs font-bold">{{SCORES.a11y}}%</span>
            </div>
            <div class="text-4xl font-bold font-mono text-white mb-2">{{SCORES.a11y}}</div>
            <p class="text-xs text-muted">WCAG 2.1 Compliance</p>
            <div class="w-full bg-white/5 h-1.5 mt-4 rounded-full overflow-hidden">
              <div class="h-full {{SCORES.a11y_bg}} transition-all duration-1000" style="width: {{SCORES.a11y}}%"></div>
            </div>
        </div>

        <!-- Best Practices -->
        <div class="glass-card rounded-2xl p-6 relative group overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition text-6xl">üõ°Ô∏è</div>
            <div class="flex justify-between items-start mb-4">
              <h3 class="text-sm font-medium text-muted uppercase tracking-wider">Best Practices</h3>
              <span class="{{SCORES.bp_color}} px-2 py-0.5 rounded text-xs font-bold">{{SCORES.bp}}%</span>
            </div>
            <div class="text-4xl font-bold font-mono text-white mb-2">{{SCORES.bp}}</div>
            <p class="text-xs text-muted">Security & Modern Web</p>
            <div class="w-full bg-white/5 h-1.5 mt-4 rounded-full overflow-hidden">
              <div class="h-full {{SCORES.bp_bg}} transition-all duration-1000" style="width: {{SCORES.bp}}%"></div>
            </div>
        </div>

        <!-- SEO -->
        <div class="glass-card rounded-2xl p-6 relative group overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition text-6xl">üîç</div>
            <div class="flex justify-between items-start mb-4">
              <h3 class="text-sm font-medium text-muted uppercase tracking-wider">SEO</h3>
              <span class="{{SCORES.seo_color}} px-2 py-0.5 rounded text-xs font-bold">{{SCORES.seo}}%</span>
            </div>
            <div class="text-4xl font-bold font-mono text-white mb-2">{{SCORES.seo}}</div>
            <p class="text-xs text-muted">Search Engine Optimization</p>
            <div class="w-full bg-white/5 h-1.5 mt-4 rounded-full overflow-hidden">
              <div class="h-full {{SCORES.seo_bg}} transition-all duration-1000" style="width: {{SCORES.seo}}%"></div>
            </div>
        </div>
      </div>

      <!-- Recent Reports -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Lighthouse History -->
        <div class="glass-card rounded-2xl p-6">
          <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
            <span>üî¶</span> Recent Lighthouse Reports
          </h3>
          <div class="space-y-3">
            {{REPORTS_LIST}}
          </div>
          <div class="mt-4 pt-4 border-t border-white/5 text-center">
            <a href="/reports" class="text-xs text-primary hover:text-primary/80 font-medium">View All Reports ‚Üí</a>
          </div>
        </div>

        <!-- Latest Analysis -->
        <div class="glass-card rounded-2xl p-6">
            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
              <span>üìà</span> Performance Analysis
            </h3>
            <div class="space-y-3">
                {{ANALYSIS_LIST}}
            </div>
        </div>
      </div>

    </div>
  </main>

  <!-- Action Modal/Output -->
  <div id="output-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center">
    <div class="bg-surface border border-white/10 rounded-2xl w-full max-w-3xl max-h-[80vh] flex flex-col shadow-2xl">
      <div class="p-4 border-b border-white/10 flex justify-between items-center">
        <h3 class="font-bold text-white" id="modal-title">Running Action...</h3>
        <button onclick="closeModal()" class="text-muted hover:text-white">‚úï</button>
      </div>
      <pre id="modal-content" class="flex-1 p-4 overflow-auto font-mono text-xs text-muted bg-black/30"></pre>
    </div>
  </div>

  <script>
    function runAction(action) {
      const modal = document.getElementById('output-modal');
      const content = document.getElementById('modal-content');
      const title = document.getElementById('modal-title');
      
      modal.classList.remove('hidden');
      content.innerText = 'Initializing...';
      title.innerText = action === 'quality' ? 'Running Quality Gate' : 'Running Performance Test';

      const endpoints = {
        'quality': '/run/quality',
        'perf': '/run/perf-test' // Endpoint espec√≠fico para o run-lighthouse novo
      };

      fetch(endpoints[action] || '/run/' + action)
        .then(response => {
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          
          function read() {
            reader.read().then(({done, value}) => {
              if (done) return;
              content.innerText += decoder.decode(value);
              content.scrollTop = content.scrollHeight;
              read();
            });
          }
          read();
        });
    }

    function closeModal() {
      document.getElementById('output-modal').classList.add('hidden');
      window.location.reload(); // Recarrega para atualizar dados
    }
  </script>
</body>
</html>
